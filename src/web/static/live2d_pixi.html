<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Live2D AI Companion - Dual Architecture Testing Interface</title>
    <link rel="stylesheet" href="css/live2d_test.css">
</head>
    
    <!-- 
    =============================================================================
    PIXI.js LIVE2D DUAL ARCHITECTURE IMPLEMENTATION STATUS
    =============================================================================
    
    üéØ CURRENT STATUS: PRODUCTION-READY LIVE2D SYSTEM ‚úÖ
    ‚úÖ Dual Runtime Support - Cubism 2.x (.moc) and Cubism 3/4/5 (.moc3)
    ‚úÖ PIXI.js 6.5.10 with proper EventEmitter compatibility
    ‚úÖ Live2D v2 Bundle (474KB) for legacy model support
    ‚úÖ Cubism 5 Core (207KB) for modern model support
    ‚úÖ Clean file organization in dist/ folder
    ‚úÖ Future-proof design with backward compatibility
    ‚úÖ Maximum compatibility with all Live2D model formats
    ‚úÖ Professional canvas sizing and model scaling
    ‚úÖ Interactive mouse dragging and positioning
    ‚úÖ Visual debugging tools (frames, hit boxes)
    ‚úÖ Smart zoom system with base scaling
    ‚úÖ Complete model lifecycle management
    ‚úÖ Motion and expression loading integration
    
    üìã PHASE 1: BASIC PIXI.js SETUP ‚úÖ COMPLETED
    ‚úÖ PIXI.js v6.5.10 integration with pixi-live2d-display v0.4.0
    ‚úÖ Canvas initialization and container setup with dynamic sizing
    ‚úÖ Version detection with async initialization
    ‚úÖ Comprehensive logging and error handling system
    ‚úÖ Mouse tracking and UI controls
    ‚úÖ Professional canvas margins and responsive design
    
    üìã PHASE 2: API INTEGRATION & MODEL LOADING ‚úÖ COMPLETED
    ‚úÖ Flask API integration (localhost:13443)
    ‚úÖ Dynamic model discovery (28+ models detected)
    ‚úÖ Model metadata parsing from API response
    ‚úÖ Static file serving integration
    ‚úÖ Model.json file loading and parsing
    ‚úÖ Complete Live2D model rendering system
    ‚úÖ Smart model interaction and positioning
    ‚úÖ Model selection dropdown population
    ‚úÖ Professional zoom controls with base scaling
    ‚úÖ Optimal model scaling (75% of canvas height)
    
    üìã PHASE 3: MODULAR SYSTEM ARCHITECTURE ‚úÖ COMPLETED
    ‚úÖ Live2D modular system design and implementation
    ‚úÖ Live2DCore class for PIXI and Live2D management
    ‚úÖ Live2DLogger unified logging system
    ‚úÖ Live2DModelManager for model lifecycle management
    ‚úÖ Live2DMotionManager for motion categorization and playback
    ‚úÖ Live2DTester for diagnostics and library validation
    ‚úÖ Live2DIntegration orchestrator class
    ‚úÖ Live2DUIController for UI management
    ‚úÖ Configuration system (live2d_config.js)
    ‚úÖ Syntax error resolution and module validation
    ‚úÖ Proper dependency loading order
    
    üìã PHASE 4: LIVE2D LIBRARY INTEGRATION ‚úÖ COMPLETED
    ‚úÖ Live2D core library loading (Cubism 2.x & 3/4/5)
    ‚úÖ PIXI.live2d display library integration
    ‚úÖ Library compatibility debugging and diagnostics
    ‚úÖ Comprehensive EventEmitter compatibility with PIXI v6+
    ‚úÖ Advanced step-by-step diagnostics system
    ‚úÖ Enhanced error handling and logging
    ‚úÖ Dual Architecture Implementation - Support for both Cubism 2.x and 3/4/5 models
    ‚úÖ PIXI.js 6.5.10 with proper EventEmitter compatibility
    ‚úÖ Live2D v2 Bundle for legacy model support
    ‚úÖ Cubism 5 Core for modern model support
    ‚úÖ Clean file organization in dist/ folder
    ‚úÖ Future-proof design with backward compatibility
    ‚úÖ Live2D model loading from Flask API with dual architecture
    ‚úÖ Complete Live2D model display with proper rendering
    ‚úÖ Model positioning and scaling within PIXI canvas
    ‚úÖ Mouse interaction system (drag-to-move)
    ‚úÖ Model hit testing and interaction zones
    
    üìã PHASE 5: UI SYSTEM INTEGRATION ‚úÖ COMPLETED
    ‚úÖ Left panel collapsible functionality
    ‚úÖ Model selection dropdown with API integration
    ‚úÖ Motion group and individual motion dropdowns
    ‚úÖ Expression selection dropdown
    ‚úÖ Professional zoom controls with slider and buttons
    ‚úÖ Model info display panel
    ‚úÖ Action buttons (Test, Reset, Copy Log, Fit)
    ‚úÖ Log panel with toggle functionality
    ‚úÖ Panel toggle button positioning and visibility
    ‚úÖ Canvas frame visualization toggle
    ‚úÖ Model frame visualization toggle
    ‚úÖ Hit area visualization toggle
    ‚úÖ Smart zoom system with base scaling
    ‚úÖ Responsive design for different screen sizes
    ‚úÖ Loading states and progress indicators
    
    üìã PHASE 6: MOTION & EXPRESSION SYSTEM ‚úÖ COMPLETED
    ‚úÖ Motion categorization system (idle, head, body, expression, special, talk)
    ‚úÖ Motion group discovery and organization
    ‚úÖ Motion queue and priority system
    ‚úÖ Random motion playback functionality
    ‚úÖ Motion statistics and debugging
    ‚úÖ Dynamic motion loading from Flask API
    ‚úÖ Real-time motion list population
    ‚úÖ Expression loading and dropdown population
    ‚úÖ Integrated motion and expression management
    
    üìã PHASE 7: ADVANCED FEATURES ‚úÖ COMPLETED
    ‚úÖ Mouse dragging with boundary constraints
    ‚úÖ Touch support via pointer events
    ‚úÖ Visual feedback during interactions
    ‚úÖ Smart canvas sizing with margins
    ‚úÖ Professional model scaling (75% height, no upscaling)
    ‚úÖ Canvas frame visualization
    ‚úÖ Model frame visualization with dimensions
    ‚úÖ Hit area visualization
    ‚úÖ Zoom as multiplier of base scale
    ‚úÖ Model centering and fit functionality
    ‚úÖ Proper model clearing on changes
    ‚úÖ Duplicate loading prevention
    ‚úÖ Complete graphics cleanup
    
    üìã PRODUCTION READY FEATURES ‚úÖ
    ‚úÖ Complete dual architecture support (Cubism 2.x + 3/4/5)
    ‚úÖ Professional canvas and model management
    ‚úÖ Interactive mouse dragging and positioning
    ‚úÖ Smart zoom system with base scaling
    ‚úÖ Visual debugging tools
    ‚úÖ Motion and expression integration
    ‚úÖ Responsive UI with collapsible panels
    ‚úÖ Flask API integration
    ‚úÖ Error handling and logging
    ‚úÖ Touch device support
    ‚úÖ Performance optimization
    ‚úÖ Clean code architecture
    
    üéØ NEXT STEPS: READY FOR AI COMPANION INTEGRATION
    - Integration with AI chat system
    - Lipsync animation during TTS
    - Emotion-based expression changes
    - Voice activity detection integration
    - Real-time conversation interactions
    ‚ùå Expression loading and application
    ‚ùå Motion/expression state synchronization
    ‚ùå Motion blending and transitions
    ‚ùå Custom motion triggers and events
    
    üìã PHASE 7: ADVANCED LIVE2D FEATURES üîÑ PLANNED
    ‚ùå Proper Live2D model rendering (not texture atlas)
    ‚ùå Model canvas sizing similar to Live2D Viewer Web
    ‚ùå Eye tracking and mouse following
    ‚ùå Breathing animation system
    ‚ùå Lip sync integration (if available)
    ‚ùå Physics simulation integration
    ‚ùå Custom shader effects
    ‚ùå Model switching animations
    ‚ùå Performance optimization
    ‚ùå Memory management and cleanup
    
    üìã PHASE 8: TESTING & VALIDATION üîÑ PLANNED
    ‚úÖ Basic diagnostics system
    ‚úÖ Library validation and compatibility testing
    ‚úÖ Syntax validation for all modules
    ‚ùå Comprehensive automated testing
    ‚ùå Performance benchmarking
    ‚ùå Cross-browser compatibility testing
    ‚ùå Mobile device support
    ‚ùå Error recovery and graceful degradation
    ‚ùå Memory leak detection and prevention
    ‚ùå Load testing with multiple models
    ‚ùå API endpoint testing and validation
    
    üìã PHASE 9: PRODUCTION FEATURES üîÑ PLANNED
    ‚ùå Configuration management system enhancement
    ‚ùå Model caching and preloading
    ‚ùå Background loading and streaming
    ‚ùå Quality settings and performance modes
    ‚ùå Export functionality (screenshots, recordings)
    ‚ùå Analytics and usage tracking
    ‚ùå Accessibility features
    ‚ùå Internationalization support
    ‚ùå User preferences and settings persistence
    ‚ùå Keyboard shortcuts and hotkeys
    
    üìã PHASE 10: DYNAMIC MODEL LOADING & COMPRESSION üîÑ PLANNED
    ‚ùå Live2D Viewer Web style model loading from multiple formats
    ‚ùå Support for ZIP compressed model files
    ‚ùå Support for JSON model definition files
    ‚ùå Support for MOC/MOC3 model files
    ‚ùå Support for CAN3 model files (current format)
    ‚ùå Automatic format detection and loading
    ‚ùå Model compression and space optimization
    ‚ùå Streaming model loading for large files
    ‚ùå Model caching and preloading system
    ‚ùå Model format converter utility
    ‚ùå Asset bundling and optimization
    ‚ùå Progressive model loading with fallbacks
    
    üìã PHASE 11: FLASK BACKEND INTEGRATION üîÑ PLANNED
    ‚ùå Flask API endpoint verification and testing
    ‚ùå Model discovery API enhancement
    ‚ùå Motion/expression API endpoint completion
    ‚ùå WebSocket integration for real-time updates
    ‚ùå Model streaming and partial loading
    ‚ùå Asset optimization and compression
    ‚ùå CDN integration for model assets
    ‚ùå Database integration for model metadata
    
    =============================================================================
    CURRENT STATUS: Phase 4 Complete - Dual Architecture Implementation
    NEXT PRIORITY: Test dual architecture with actual model loading
    ARCHITECTURE ACHIEVEMENTS:
    - ‚úÖ Dual Runtime Support Complete (Cubism 2.x + 3/4/5)
    - ‚úÖ PIXI.js 6.5.10 with EventEmitter compatibility
    - ‚úÖ Clean file organization in dist/ folder
    - ‚úÖ Future-proof design with backward compatibility
    REMAINING WORK:
    - Fix Live2D model display to show actual models, not atlas maps
    - Test dual architecture with both .moc and .moc3 models
    - Panel toggle functionality needs fixing
    - Log panel visibility behavior needs work
    - API integration needs testing and validation
    =============================================================================
    -->
</head>
<body>
    <div class="app-container">
        <!-- Left Panel -->
        <div class="left-panel" id="leftPanel">
            <div class="panel-header">
                <div class="panel-title">Live2D AI Companion</div>
                <button class="panel-close" onclick="togglePanel(false)">√ó</button>
            </div>
            
            <div class="model-section">
                <div class="model-header">
                    <div class="model-id" id="modelId">#1</div>
                    <div class="model-name" id="modelName" onclick="showModelInfo()">
                        Select a model to begin
                    </div>
                </div>
                
                <div class="control-group">
                    <h3>Display Controls</h3>
                    <div class="form-group">
                        <label for="zoomSlider">Scale: <span id="zoomValue">1.0</span></label>
                        <input type="range" id="zoomSlider" min="0.1" max="3.0" step="0.1" value="1.0" oninput="updateZoom(this.value); document.getElementById('zoomValue').textContent = this.value;">
                    </div>
                    <div class="control-buttons">
                        <button class="btn btn-secondary" onclick="resetZoom()">Reset</button>
                        <button class="btn btn-secondary" onclick="fitModel()">Fit</button>
                        <button class="btn btn-secondary" onclick="centerModel()">Center</button>
                    </div>
                </div>
                
                <div class="control-group">
                    <h3>Motions</h3>
                    <div class="form-group">
                        <label for="motionGroupSelect">Motion Group:</label>
                        <select id="motionGroupSelect" onchange="onMotionGroupChange()">
                            <option value="">No motions available</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="motionSelect">Motion:</label>
                        <select id="motionSelect" onchange="onMotionTypeChange()">
                            <option value="">Select motion group first</option>
                        </select>
                    </div>
                    <div class="control-buttons">
                        <button class="btn btn-primary" onclick="playSelectedMotion()">Play Motion</button>
                        <button class="btn btn-secondary" onclick="playRandomMotion()">Random</button>
                    </div>
                </div>
                
                <div class="control-group">
                    <h3>Expressions</h3>
                    <div class="form-group">
                        <label for="expressionSelect">Expression:</label>
                        <select id="expressionSelect" onchange="onExpressionChange()">
                            <option value="">No expressions available</option>
                        </select>
                    </div>
                    <div class="control-buttons">
                        <button class="btn btn-primary" onclick="playExpression()">Apply Expression</button>
                        <button class="btn btn-secondary" onclick="resetExpression()">Reset</button>
                    </div>
                </div>
                
                <div class="control-group">
                    <h3>Model Info</h3>
                    <div class="info-display" id="modelInfo">
                        <div class="info-row">
                            <span class="info-label">Status:</span>
                            <span class="info-value" id="modelStatus">
                                <span class="status-indicator status-warning"></span>
                                No model loaded
                            </span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">Position:</span>
                            <span class="info-value" id="modelPosition">0, 0</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">Scale:</span>
                            <span class="info-value" id="modelScale">1.0</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">Mouse:</span>
                            <span class="info-value" id="mousePosition">0, 0</span>
                        </div>
                    </div>
                </div>
                
                <div class="control-group">
                    <h3>Actions</h3>
                    <div class="control-buttons">
                        <button class="btn btn-primary" onclick="testModel()">Test Model</button>
                        <button class="btn btn-warning" onclick="resetModel()">Reset</button>
                    </div>
                </div>
                
                <div class="control-group">
                    <h3>Diagnostics</h3>
                    <div class="control-buttons">
                        <button class="btn btn-secondary" onclick="toggleSettings()">‚öôÔ∏è Settings</button>
                        <button class="btn btn-info" onclick="debugModel()">Debug Info</button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Settings Panel -->
        <div class="settings-panel" id="settingsPanel">
            <div class="settings-header">
                <span>Live2D Viewer Settings</span>
                <button class="panel-close" onclick="toggleSettings()">√ó</button>
            </div>
            <div class="settings-content">
                <div class="settings-group">
                    <h4>Display Options</h4>
                    <div class="setting-item">
                        <label>
                            <input type="checkbox" id="showCanvasFrame" checked onchange="toggleCanvasFrame()">
                            Show Canvas Frame
                        </label>
                    </div>
                    <div class="setting-item">
                        <label>
                            <input type="checkbox" id="showModelFrame" onchange="toggleModelFrame()">
                            Show Model Frame
                        </label>
                    </div>
                    <div class="setting-item">
                        <label>
                            <input type="checkbox" id="showHitAreas" onchange="toggleHitAreas()">
                            Show Hit Areas
                        </label>
                    </div>
                </div>
                
                <div class="settings-group">
                    <h4>Debug Options</h4>
                    <div class="setting-item">
                        <label>
                            <input type="checkbox" id="debugMode" onchange="toggleDebugMode()">
                            Debug Mode
                        </label>
                    </div>
                    <div class="setting-item">
                        <label>
                            <input type="checkbox" id="showFPS" onchange="toggleFPS()">
                            Show FPS Counter
                        </label>
                    </div>
                    <div class="setting-item">
                        <label>
                            <input type="checkbox" id="logMouseEvents" onchange="toggleMouseLogging()">
                            Log Mouse Events
                        </label>
                    </div>
                </div>
                
                <div class="settings-group">
                    <h4>Performance</h4>
                    <div class="setting-item">
                        <label for="renderQuality">Render Quality:</label>
                        <select id="renderQuality" onchange="changeRenderQuality()">
                            <option value="high">High</option>
                            <option value="medium" selected>Medium</option>
                            <option value="low">Low</option>
                        </select>
                    </div>
                    <div class="setting-item">
                        <label>
                            <input type="checkbox" id="enableAntialiasing" checked onchange="toggleAntialiasing()">
                            Enable Antialiasing
                        </label>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Canvas Area -->
        <div class="canvas-container">
            <div class="canvas-frame">
                <div id="pixiContainer"></div>
            </div>
            <div class="loading-overlay" id="loadingOverlay" style="display: none;">
                <div class="loading-spinner"></div>
            </div>
        </div>
        
        <!-- Panel Toggle Button -->
        <button class="panel-toggle" id="panelToggle" onclick="togglePanel(true)">‚ò∞</button>
    </div>

<!-- Load PIXI.js and Live2D libraries in correct order -->
<!-- Step 1: Load PIXI.js 6.5.10 from dist folder -->
<script src="dist/pixi-6.5.10.min.js"></script>

<!-- Step 2: Load EventEmitter compatibility for PIXI v6 -->
<script src="js/eventemitter-preloader-v6.js"></script>

<!-- Step 3: Load Live2D v2 Bundle for Cubism 2.x models -->
<script src="dist/live2d_bundle.js"></script>

<!-- Step 4: Load Cubism 5 Core for modern models -->
<script src="dist/CubismSdkForWeb-5-r.4/Core/live2dcubismcore.min.js"></script>

<!-- Step 6: Verify dual architecture setup -->
<script>
console.log('=== Dual Architecture Verification ===');
console.log('PIXI version:', typeof PIXI !== 'undefined' ? PIXI.VERSION : 'Not loaded');
console.log('EventEmitter available:', typeof EventEmitter !== 'undefined');
console.log('Live2D v2 Bundle loaded:', typeof window.Live2D !== 'undefined');
console.log('Cubism 5 Core loaded:', typeof window.Live2DCubismCore !== 'undefined');

// Debug Live2D v2 Bundle
if (typeof window.Live2D !== 'undefined') {
    console.log('‚úì Live2D v2 Bundle ready for Cubism 2.x models');
    console.log('- window.Live2D:', typeof window.Live2D);
    console.log('- window.Live2DModelWebGL:', typeof window.Live2DModelWebGL);
    console.log('- window.live2dv2:', typeof window.live2dv2);
}

// Debug Cubism 5 Core
if (typeof window.Live2DCubismCore !== 'undefined') {
    console.log('‚úì Cubism 5 Core ready for modern models');
    console.log('- Core version:', window.Live2DCubismCore.Version ? window.Live2DCubismCore.Version.csmGetVersion() : 'unknown');
}

console.log('=== End Verification ===');
</script>

<!-- Step 5: Load pixi-live2d-display -->
<script src="https://cdn.jsdelivr.net/npm/pixi-live2d-display@0.4.0/dist/index.min.js"></script>

<!-- Step 5: Verify Live2D plugin initialization -->
<script>
// Initialize Live2D plugin following Live2D Viewer Web pattern
console.log('Initializing Live2D plugin (Live2D Viewer Web compatible)...');

// Wait for all scripts to load
document.addEventListener('DOMContentLoaded', function() {
    setTimeout(function() {
        console.log('Checking library compatibility...');
        
        // Verify libraries are loaded
        if (typeof PIXI === 'undefined') {
            console.error('PIXI.js not loaded');
            return;
        }
        
        if (typeof EventEmitter === 'undefined') {
            console.error('EventEmitter not available');
            return;
        }
        
        console.log('‚úì PIXI version:', PIXI.VERSION);
        console.log('‚úì EventEmitter type:', typeof EventEmitter);
        
        // Check if PIXI.utils.EventEmitter exists (Live2D Viewer Web pattern)
        if (PIXI.utils && PIXI.utils.EventEmitter) {
            console.log('‚úì PIXI.utils.EventEmitter available (Live2D Viewer Web compatible)');
        }
        
        // Check if Live2D plugin is available
        if (typeof PIXI.live2d === 'undefined') {
            console.error('‚úó PIXI.live2d not loaded - pixi-live2d-display may not be compatible');
            console.log('Available PIXI properties:', Object.keys(PIXI));
            
            // Try to diagnose the issue
            if (window.pixiLive2DLoadError) {
                console.error('Library loading error detected - check network tab');
            }
        } else {
            console.log('‚úì PIXI.live2d loaded successfully');
            console.log('Available PIXI.live2d properties:', Object.keys(PIXI.live2d));
            
            // Check for Live2DModel
            if (PIXI.live2d.Live2DModel) {
                console.log('‚úì Live2DModel class available');
                window.Live2DModel = PIXI.live2d.Live2DModel;
                
                // Test if it has the expected methods
                if (typeof PIXI.live2d.Live2DModel.from === 'function') {
                    console.log('‚úì Live2DModel.from() method available');
                } else {
                    console.warn('Live2DModel.from() method not found');
                }
            } else {
                console.warn('Live2DModel not found in PIXI.live2d');
            }
            
            // Check for Live2DFactory
            if (PIXI.live2d.Live2DFactory) {
                console.log('‚úì Live2DFactory available');
                window.Live2DFactory = PIXI.live2d.Live2DFactory;
            } else {
                console.warn('Live2DFactory not found in PIXI.live2d');
            }
        }
        
        console.log('Live2D plugin initialization check complete');
        console.log('System ready for Live2D model loading');
        
    }, 500); // Increased delay to ensure all libraries are loaded
});
</script>

<!-- Step 5: Load Live2D modular system -->
<script src="js/live2d_config.js"></script>
<script src="js/live2d_logger.js"></script>
<script src="js/live2d_tester.js"></script>
<script src="js/live2d_interaction.js"></script>
<script src="js/live2d_core.js"></script>
<script src="js/live2d_model_manager.js"></script>
<script src="js/live2d_multi_model_manager.js"></script>
<script src="js/live2d_motion_manager.js"></script>
<script src="js/live2d_integration.js"></script>
<script src="js/live2d_ui_controller.js"></script>
<script src="js/live2d_simple_fix.js"></script>

<script>
// Global variables for the modular system
let live2dIntegration = null;
let uiController = null;
let live2dMultiModelManager = null; // Make available globally for remove buttons

// Initialize the modular Live2D system
async function initializeLive2D() {
    try {
        console.log('Initializing Live2D modular system...');
        
        // Create integration instance
        live2dIntegration = new Live2DIntegration();
        
        // Initialize integration (canvas container)
        const success = await live2dIntegration.initialize('pixiContainer');
        
        if (!success) {
            throw new Error('Failed to initialize Live2D integration');
        }
        
        // Create UI controller
        uiController = new Live2DUIController(live2dIntegration);
        
        // Initialize UI controller
        await uiController.initialize();
        
        // Store reference to multi-model manager for global access
        live2dMultiModelManager = live2dIntegration.modelManager;
        
        // Set up connection between multi-model manager and UI controller
        live2dMultiModelManager.setUIController(uiController);
        
        console.log('Live2D system initialized successfully!');
        
    } catch (error) {
        console.error('Failed to initialize Live2D system:', error);
    }
}

// Global functions for HTML onclick handlers
function togglePanel(force) {
    console.log('togglePanel called with force:', force);
    if (uiController) {
        uiController.togglePanel(force);
    } else {
        console.error('uiController not available');
    }
}

function onModelChange() {
    console.log('onModelChange called');
    if (uiController) {
        const modelName = document.getElementById('modelSelect').value;
        uiController.onModelChange(modelName);
    } else {
        console.error('uiController not available');
    }
}

function updateZoom(value) {
    if (live2dIntegration && live2dIntegration.core) {
        live2dIntegration.core.scaleModel(parseFloat(value));
    }
}

function resetZoom() {
    if (live2dIntegration && live2dIntegration.core) {
        live2dIntegration.core.scaleModel(1.0);
        // Update slider
        const slider = document.getElementById('zoomSlider');
        if (slider) slider.value = 1.0;
        // Update display
        const display = document.getElementById('zoomValue');
        if (display) display.textContent = '1.0';
    }
}

function fitModel() {
    if (live2dIntegration && live2dIntegration.core && live2dIntegration.core.interactionManager) {
        live2dIntegration.core.interactionManager.fitModelToCanvas();
    }
}

function centerModel() {
    if (live2dIntegration && live2dIntegration.core && live2dIntegration.core.interactionManager) {
        live2dIntegration.core.interactionManager.centerModel();
    }
}

function onMotionGroupChange() {
    if (uiController) {
        const group = document.getElementById('motionGroupSelect').value;
        uiController.onMotionGroupChange(group);
    }
}

function onMotionTypeChange() {
    if (uiController) {
        const motion = document.getElementById('motionSelect').value;
        uiController.onMotionTypeChange(motion);
    }
}

function playSelectedMotion() {
    if (uiController) uiController.playSelectedMotion();
}

function playRandomMotion() {
    if (uiController) uiController.playRandomMotion();
}

function onExpressionChange() {
    if (uiController) {
        const expression = document.getElementById('expressionSelect').value;
        uiController.onExpressionChange(expression);
    }
}

function playExpression() {
    if (uiController) uiController.playExpression();
}

function resetExpression() {
    if (uiController) uiController.resetExpression();
}

function testModel() {
    if (uiController) uiController.testModel();
}

function resetModel() {
    console.log('resetModel called');
    if (uiController) {
        uiController.resetModel();
    } else {
        console.error('uiController not available');
    }
}

function toggleSettings() {
    console.log('toggleSettings called');
    if (uiController) {
        uiController.toggleSettings();
    } else if (window.toggleSettingsPanel) {
        window.toggleSettingsPanel();
    } else {
        console.error('uiController and toggleSettingsPanel not available');
    }
}

function debugModel() {
    console.log('debugModel called');
    if (uiController) {
        uiController.debugModel();
    } else {
        console.error('uiController not available');
    }
}

function toggleCanvasFrame() {
    if (uiController) uiController.toggleCanvasFrame();
}

function toggleModelFrame() {
    if (uiController) uiController.toggleModelFrame();
}

function toggleHitAreas() {
    if (uiController) uiController.toggleHitAreas();
}

function toggleDebugMode() {
    if (uiController) uiController.toggleDebugMode();
}

function toggleFPS() {
    if (uiController) uiController.toggleFPS();
}

function toggleMouseLogging() {
    if (uiController) uiController.toggleMouseLogging();
}

function changeRenderQuality() {
    if (uiController) uiController.changeRenderQuality();
}

function toggleAntialiasing() {
    if (uiController) uiController.toggleAntialiasing();
}

function showModelInfo() {
    if (live2dIntegration) {
        live2dIntegration.debugModelBounds();
        live2dIntegration.core.debugModelVisibility();
    }
}

// Initialize when DOM is ready
document.addEventListener('DOMContentLoaded', function() {
    // Wait for all libraries to load properly
    setTimeout(async function() {
        console.log('Libraries loaded, checking availability...');
        
        // Check library availability
        if (typeof PIXI === 'undefined') {
            console.error('PIXI.js not loaded');
            return;
        }
        
        if (typeof EventEmitter === 'undefined') {
            console.error('EventEmitter not available');
            return;
        }
        
        console.log('PIXI version:', PIXI.VERSION);
        console.log('EventEmitter available:', typeof EventEmitter !== 'undefined');
        
        // Initialize the Live2D system
        await initializeLive2D();
    }, 1000); // Increased delay to ensure libraries are loaded
});

</script>
</body>
</html>
